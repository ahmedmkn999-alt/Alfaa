<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المحاضرات | FULL MARK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="auth.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background: #020617; color: white; font-family: 'Tajawal', sans-serif; min-height: 100vh; padding-bottom: 50px; }
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% -10%, #1e1b4b, #020617 80%); }
        
        /* كارت المحاضرة المحسن */
        .lecture-card { 
            background: rgba(30, 41, 59, 0.4); 
            border: 1px solid rgba(99, 102, 241, 0.15); 
            border-radius: 30px; 
            padding: 25px; 
            margin-bottom: 24px; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
        }
        .lecture-card:hover { 
            transform: translateY(-8px); 
            border-color: #6366f1; 
            background: rgba(30, 41, 59, 0.6);
            box-shadow: 0 20px 40px -15px rgba(99, 102, 241, 0.3);
        }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .lec-label { color: #a855f7; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .lec-title { font-size: 1.4rem; font-weight: 800; color: #fff; margin-top: 4px; }
        
        .lec-img-box { 
            width: 70px; height: 70px; border-radius: 20px; 
            background: linear-gradient(135deg, #6366f1, #d946ef); 
            padding: 2px; shadow: 0 10px 15px rgba(99, 102, 241, 0.2);
        }
        .lec-img { width: 100%; height: 100%; border-radius: 18px; object-fit: cover; background: #0f172a; padding: 10px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .stat-box { 
            background: rgba(2, 6, 23, 0.4); 
            border-radius: 18px; padding: 12px 5px; 
            text-align: center; border: 1px solid rgba(255, 255, 255, 0.03); 
        }
        .stat-icon { font-size: 1.1rem; color: #6366f1; margin-bottom: 4px; }
        
        .btn-content { 
            background: linear-gradient(135deg, #1e293b, #0f172a); 
            color: white; width: 100%; padding: 18px; 
            border-radius: 20px; font-weight: 800; 
            display: flex; justify-content: center; align-items: center; 
            gap: 12px; border: 1px solid rgba(99, 102, 241, 0.2); 
            transition: 0.3s;
        }
        .lecture-card:hover .btn-content {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            border-color: transparent;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.2);
        }

        .branding {
            text-align: center; margin-top: 40px; opacity: 0.3; font-size: 0.7rem; letter-spacing: 3px;
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    <div id="app" class="p-5 max-w-2xl mx-auto">
        
        <div class="flex items-center gap-5 mb-10">
            <button @click="window.history.back()" class="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl text-white flex items-center justify-center hover:bg-white/10 transition-all">
                <i class="fas fa-arrow-right"></i>
            </button>
            <div>
                <p class="text-indigo-400 text-xs font-bold uppercase tracking-wider">قائمة الدروس</p>
                <h1 class="text-2xl font-black">{{ teacherName }}</h1>
            </div>
        </div>

        <div v-if="loading" class="flex flex-col items-center mt-20 opacity-50">
            <div class="w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p>جاري استدعاء المحاضرات...</p>
        </div>

        <div v-else>
            <div v-for="(ch, index) in allLectures" :key="index" class="lecture-card">
                <div class="card-header">
                    <div>
                        <span class="lec-label">المحاضرة #{{ index + 1 }}</span>
                        <h2 class="lec-title">{{ ch.chapter_name || ch.name }}</h2>
                    </div>
                    <div class="lec-img-box">
                        <img src="https://cdn-icons-png.flaticon.com/512/3413/3413535.png" class="lec-img" alt="lesson icon">
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <i class="fas fa-play-circle stat-icon"></i>
                        <div class="font-bold">{{ getVideos(ch).length }}</div>
                        <div class="text-[10px] text-gray-500 uppercase">فيديو</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-file-pdf stat-icon"></i>
                        <div class="font-bold">0</div>
                        <div class="text-[10px] text-gray-500 uppercase">ملخص</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-tasks stat-icon"></i>
                        <div class="font-bold">0</div>
                        <div class="text-[10px] text-gray-500 uppercase">اختبار</div>
                    </div>
                </div>

                <button @click="openLecture(ch)" class="btn-content group">
                    عرض محتوى المحاضرة 
                    <i class="fas fa-chevron-left text-sm group-hover:-translate-x-2 transition-transform"></i>
                </button>
            </div>
        </div>

        <div class="branding">
            DEVELOPED BY ELGIZAWY
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        createApp({
            setup() {
                const allLectures = ref([]);
                const loading = ref(true);
                const teacherName = ref('');
                const params = new URLSearchParams(window.location.search);

                const getVideos = (ch) => {
                    let vids = [];
                    if(ch.videos) vids = [...ch.videos];
                    if(ch.lectures) ch.lectures.forEach(l => { if(l.videos) vids = [...vids, ...l.videos] });
                    return vids;
                };

                const openLecture = (ch) => {
                    localStorage.setItem('selectedLectureVids', JSON.stringify(getVideos(ch)));
                    localStorage.setItem('selectedLectureTitle', ch.chapter_name || ch.name);
                    window.location.href = 'parts.html';
                };

                onMounted(async () => {
                    checkAuth();
                    const db = firebase.database();
                    const code = localStorage.getItem('alpha_user_code');
                    const snap = await db.ref('approvedStudents/'+code).once('value');
                    const userData = snap.val();
                    
                    // استخدام الروابط بناءً على الشعبة كما في الصفحات السابقة
                    const URLS = {
                        'علمي علوم': "https://plus-teal.vercel.app/organized_output.json",
                        'أدبي': "https://plus-teal.vercel.app/organized_output-a.json", 
                        'علمي رياضة': "https://platform-sigma-seven.vercel.app/organized_output-e.json"
                    };

                    const res = await fetch(URLS[userData.section] || URLS['علمي علوم']);
                    const data = await res.json();
                    
                    const year = data.find(y => y.id == params.get('yid')) || data[0];
                    const sub = year.subjects.find(s => s.id == params.get('sid'));
                    const teacher = sub.teachers.find(t => t.id == params.get('tid'));
                    
                    teacherName.value = teacher.name;
                    
                    let tempLectures = [];
                    if(teacher.units) {
                        teacher.units.forEach(u => { if(u.chapters) tempLectures.push(...u.chapters); });
                    } else if(teacher.chapters) {
                        tempLectures = teacher.chapters;
                    }
                    allLectures.value = tempLectures;
                    loading.value = false;
                });
                return { allLectures, loading, teacherName, getVideos, openLecture };
            }
        }).mount('#app');
    </script>
</body>
</html>
